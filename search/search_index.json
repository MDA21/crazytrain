{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Welcome to MkDocs","text":"<p>For full documentation visit mkdocs.org.</p>"},{"location":"#commands","title":"Commands","text":"<ul> <li><code>mkdocs new [dir-name]</code> - Create a new project.</li> <li><code>mkdocs serve</code> - Start the live-reloading docs server.</li> <li><code>mkdocs build</code> - Build the documentation site.</li> <li><code>mkdocs -h</code> - Print help message and exit.</li> </ul>"},{"location":"#project-layout","title":"Project layout","text":"<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"},{"location":"TinyRenderer/","title":"TinyRenderer\u4e2a\u4eba\u5b66\u4e60\u7b14\u8bb0","text":"<p>Github\u4ed3\u5e93</p> <p>\u8fd9\u4efd\u7b14\u8bb0\u5927\u81f4\u6309\u7167\u7684\u662fTinyRenderer\u7684\u987a\u5e8f\u6765\u5b9e\u73b0\u8f6f\u5149\u6805\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u7167\u642c\u3002\u7b14\u8bb0\u4e3b\u8981\u8bb0\u5f55\u7684\u662f\u81ea\u5df1\u5728\u5b9e\u73b0\u8fc7\u7a0b\u4e2d\u5b8c\u6210\u7684\u90e8\u5206\u3001\u4e00\u4e9b\u4f18\u5316\u601d\u8def\uff0c\u4e0d\u4f1a\u8d58\u8ff0\u539f\u9879\u76ee\u7684\u5185\u5bb9\u3002\u9119\u4eba\u624d\u758f\u5b66\u6d45\uff0c\u96be\u514d\u72af\u9519\uff0c\u6709\u95ee\u9898\u8fd8\u8bf7\u5927\u5bb6\u6307\u6b63\u3002</p>"},{"location":"TinyRenderer/#bresenham","title":"Bresenham\u753b\u7ebf","text":"<p>\u8fd9\u90e8\u5206\u7684\u76ee\u6807\u662f\u6413\u4e00\u4e2a\u80fd\u753b<code>.obj</code>\u8f6e\u5ed3\u7684\u7a0b\u5e8f</p> <p>\u6559\u7a0b\u4e2d\u63d0\u4f9b\u4e86<code>tgaimage.h</code>\u548c<code>tgaimage.cpp</code>\uff0c\u5176\u4e2d\u5305\u542b\u4e86\u5bf9<code>.tga</code>\u683c\u5f0f\u6700\u57fa\u672c\u7684\u5904\u7406\u51fd\u6570\uff0c\u5269\u4e0b\u7684\u90fd\u662f\u81ea\u5df1\u6413\u3002</p>"},{"location":"TinyRenderer/#_1","title":"\u7b2c\u4e00\u6b21\u5c1d\u8bd5","text":""},{"location":"TinyRenderer/#_2","title":"\u6587\u4ef6\u7ed3\u6784","text":"<pre><code>tinyrenderer/\n\u251c\u2500\u2500 include/           # \u6240\u6709\u5934\u6587\u4ef6\u76ee\u5f55\n\u2502   \u251c\u2500\u2500 vector.h\n\u2502   \u251c\u2500\u2500 model.h\n\u2502   \u2514\u2500\u2500 tgaimage.h\n\u2514\u2500\u2500 src/               # \u6240\u6709\u6e90\u6587\u4ef6\u76ee\u5f55\n    \u251c\u2500\u2500 model.cpp\n    \u251c\u2500\u2500 tgaimage.cpp\n    \u2514\u2500\u2500 main.cpp\n</code></pre>"},{"location":"TinyRenderer/#vectorh","title":"vector.h","text":"<p>\u6211\u4eec\u9700\u8981\u4e00\u79cd\u6570\u636e\u7ed3\u6784\u6765\u5b58\u50a8\u9876\u70b9\uff08vertex\uff09\u7684xyz\u5750\u6807\uff0c\u7531\u4e8e\u4e0d\u80fd\u7528<code>Eigen</code>\u5e93\uff0c\u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\u4e00\u4e2a\u7b80\u5355\u7684\u7ed3\u6784\u5c31\u884c\uff0c\u8fd9\u5c31\u662f<code>vector.h</code>\u3002</p> <pre><code>struct Vec2i\n{\n    int x, y;\n    Vec2i(int x = 0, int y = 0) : x(x), y(y) {}\n};\n\nstruct Vec3f\n{\n    float x, y, z;\n    Vec3f(float x = 0, float y = 0, float z = 0) : x(x), y(y), z(z) {}\n};\n</code></pre> <p>\u5206\u522b\u5305\u542b\u4e00\u4e2a\u4e8c\u7ef4\u6574\u6570\u5411\u91cf\u548c\u4e00\u4e2a\u4e09\u7ef4\u6d6e\u70b9\u5411\u91cf\u7684\u5b9a\u4e49\u3002</p> <p>tips: \u6807\u51c6\u5e93\u91cc\u7684std::vector\u662f\u52a8\u6001\u6570\u7ec4\u3002</p>"},{"location":"TinyRenderer/#modelh","title":"model.h","text":"<p>\u8fd9\u4e2a\u5934\u6587\u4ef6\u5305\u542b\u4e86Model\u7c7b\u7684\u5b9a\u4e49\u548c\u65b9\u6cd5\uff0c\u5176\u4e2d<code>filename</code>\u5c31\u662f\u6587\u4ef6\u7684\u8def\u5f84\u3002</p> <pre><code>#include &lt;string&gt;\n#include &lt;vector&gt;\n#include \"vector.h\"\n\nclass Model\n{\npublic:\n    Model(const std::string&amp; filename);     //\u52a0\u8f7d\u6a21\u578b\n    int nverts() const;     //\u8fd4\u56de\u9876\u70b9\u6570\u91cf\n    int nfaces() const;     //\u8fd4\u56de\u9762\u6570\u91cf\n    Vec3f vert(const int i) const;      //\u8fd4\u56de\u7b2ci\u4e2a\u9876\u70b9\u5750\u6807\n    Vec3f vert(const int iface, const int nthvert) const;   \n    //\u8fd4\u56de\u7b2ciface\u4e2a\u9762\u7b2cnthvert\u4e2a\u9876\u70b9\u5750\u6807\n\nprivate:\n    std::vector&lt;Vec3f&gt; verts;\n    std::vector&lt;std::vector&lt;int&gt;&gt; faces;\n};\n\nvoid Log(const std::string&amp; message);   \n</code></pre>"},{"location":"TinyRenderer/#modelcpp","title":"model.cpp","text":"<p>\u4e3b\u8981\u7684\u51fd\u6570\u662f<code>Model::Model(const std::string&amp; filename)</code>\uff0c\u7528\u4e8e\u52a0\u8f7d\u6a21\u578b</p> <p>\u6559\u7a0b\u63d0\u4f9b\u4e86\u4e00\u4e2awavefront obj\u6587\u4ef6\uff0c\u6211\u4eec\u9700\u8981\u5148\u5927\u81f4\u4e86\u89e3\u4e00\u4e0b\u8fd9\u79cd\u683c\u5f0f\uff0c\u8fd9\u79cd\u683c\u5f0f\u662f\u7eaf\u6587\u672c\u7684\uff0c\u53ef\u4ee5\u76f4\u63a5\u7528vscode\u6253\u5f00\u3002</p> <p>\u4e00\u4e2a<code>.obj</code>\u6587\u4ef6\u901a\u5e38\u5b58\u50a8\u4e86\u4e24\u5927\u7c7b\u4fe1\u606f\uff1a\u6570\u636e\u70b9 \u548c \u62d3\u6251\u7ed3\u6784</p> <p>\u6570\u636e\u70b9\u90e8\u5206\u901a\u5e38\u4f4d\u4e8e\u6587\u4ef6\u7684\u524d\u534a\u90e8\u5206\uff0c\u5b9a\u4e49\u4e86\u6a21\u578b\u6240\u6709\u7684\u539f\u6750\u6599</p> <pre><code>v 0.11526 0.700717 0.0677257\n...\n\nvt  0.067 0.290 0.173\n...\n\nvn  0.447 0.893 -0.051\n..\n</code></pre> <p>v - \u51e0\u4f55\u9876\u70b9</p> <p>vt - \u7eb9\u7406\u5750\u6807</p> <p>vn - \u9876\u70b9\u6cd5\u7ebf</p> <p>\u62d3\u6251\u90e8\u5206\u90e8\u5206\u662f f (Face)\uff0c\u5b83\u4e0d\u5b58\u50a8\u5750\u6807\uff0c\u53ea\u5b58\u50a8\u7d22\u5f15\u3002\u5b83\u544a\u8bc9\u8ba1\u7b97\u673a\uff1a\u628a\u7b2c\u51e0\u4e2a\u70b9\u3001\u7b2c\u51e0\u4e2a\u7eb9\u7406\u3001\u7b2c\u51e0\u4e2a\u6cd5\u7ebf\u8fde\u8d77\u6765\uff0c\u6784\u6210\u4e00\u4e2a\u9762\uff0c<code>f v/vt/vn v/vt/vn  v/vt/vn</code>\u3002</p> <pre><code>f 680/701/680 679/700/679 684/738/684\n</code></pre> <p>\u5927\u591a\u6570\u73b0\u4ee3 GPU \u53ea\u80fd\u753b\u4e09\u89d2\u5f62\uff0c\u5982\u679c\u4f60\u8bfb\u5230\u4e86\u56db\u8fb9\u5f62\uff0c\u901a\u5e38\u9700\u8981\u5728\u4ee3\u7801\u91cc\u628a\u5b83\u62c6\u5206\u6210\u4e24\u4e2a\u4e09\u89d2\u5f62\u3002\u672c\u6b21\u63d0\u4f9b\u7684\u6697\u9ed1\u7834\u574f\u795e\u7684\u6a21\u578b\u90fd\u662f\u4e09\u89d2\u5f62\uff0c\u4f46\u662f\u5982\u679c\u53bbblender\u76f4\u63a5\u5bfc\u51fa\u4e00\u4e2a\u7acb\u65b9\u4f53\u7684\u8bdd\uff0c\u4f60\u5c31\u4f1a\u53d1\u73b0 f \u884c\u6bcf\u884c\u6709\u56db\u7ec4\uff0c\u4e0d\u8fc7\u6211\u5728\u7b2c\u4e00\u6b21\u5b9e\u73b0\u4e2d\u6ca1\u6709\u7ba1\u56db\u8fb9\u5f62\u3002</p> <p>\u5269\u4e0b\u7684\u57fa\u672c\u4e0a\u5c31\u662f\u6807\u51c6\u5e93\u7684\u4f7f\u7528\u4e86\uff0cc with stl\u8fd9\u4e00\u5757\u3002\u5728\u7b2c\u4e00\u90e8\u5206\u7684\u5185\u5bb9\u4e2d\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u7ba1\u6cd5\u7ebf\u548c\u7eb9\u7406\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u9700\u8981\u8bfb\u53d6\u548c\u8bc6\u522b v \u548c f \uff0c\u5176\u4f59\u90e8\u5206\u53ef\u4ee5\u90fd\u4e22\u6389\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0cf \u7684\u7d22\u5f15\u4ece 1 \u5f00\u59cb\uff0c\u6240\u4ee5\u628a\u9762\u5b58\u5165\u52a8\u6001\u6570\u7ec4\u65f6\u9700\u8981\u628a\u7d22\u5f15\u51cf1\u3002</p> <pre><code>#include &lt;string&gt;\n#include &lt;iostream&gt;\n#include &lt;vector&gt;\n#include &lt;fstream&gt;\n#include &lt;sstream&gt;\n#include \"../include/model.h\"\n\nvoid Log(const std::string&amp; message) {\n    std::cout &lt;&lt; message &lt;&lt; std::endl;\n}\n\nModel::Model(const std::string&amp; filename) {\n    std::ifstream in;\n    in.open(filename);\n\n    if (!in.is_open()) {\n        Log(\"Cannot open file: \" + filename);\n        return;\n    }\n\n    std::string line;\n    while (!in.eof()) {\n        std::getline(in, line);\n        std::istringstream iss(line);\n        std::string type;\n        iss &gt;&gt; type;\n\n        if (type == \"v\") {\n            float x, y, z;\n            iss &gt;&gt; x &gt;&gt; y &gt;&gt; z;\n            verts.push_back(Vec3f(x, y, z));\n        }\n        else if (type == \"f\") {\n            //blender\u7684\u5bfc\u51fa\u683c\u5f0f\u662f f  v/vt/vn..\n            std::vector&lt;int&gt; face_indices;\n            int idx;\n            char trash; //\u7528\u6765\u5403\u6389\u659c\u6760\n\n            while (iss &gt;&gt; idx) {\n                idx--;\n                face_indices.push_back(idx);\n\n                if(iss.peek() == '/') {\n                    iss &gt;&gt; trash;\n                    if (iss.peek() != '/') {\n                        //\u5904\u7406\u7eb9\u7406vt\n                        int vt;\n                        iss &gt;&gt; vt;\n                    }\n\n                    if (iss.peek() == '/') {\n                        iss &gt;&gt; trash;\n                        //\u5904\u7406\u6cd5\u7ebf\n                        int vn;\n                        iss &gt;&gt; vn;\n                    }\n                }\n            }\n            faces.push_back(face_indices);\n        }\n        else continue;\n    }\n}\n\nint Model::nverts() const {\n    return static_cast&lt;int&gt;(verts.size());\n}\n\nint Model::nfaces() const {\n    return static_cast&lt;int&gt;(faces.size());\n}\n\nVec3f Model::vert(const int i) const {\n    return verts[i];\n}\n\nVec3f Model::vert(const int iface, const int nthvert) const {\n    return verts[faces[iface][nthvert]];\n}\n</code></pre>"},{"location":"TinyRenderer/#maincpp","title":"main.cpp","text":"<p>\u63a5\u4e0b\u6765\u8981\u7528\u8bfb\u53d6\u5230\u7684\u6570\u636e\u753b\u7ebf\u4e86\uff0c\u4f46\u662f\u6211\u4eec\u4ecd\u7136\u4f1a\u9047\u5230\u4e24\u4e2a\u95ee\u9898\u3002</p> <p>1\u3001\u6211\u4eec\u8bfb\u53d6\u7684\u5750\u6807\u4fe1\u606f\u5305\u542b\u4e86 $$z$$ \u8f74\uff0c\u4f46\u662f\u76ee\u524d\u6211\u4eec\u53ea\u77e5\u9053\u8bbe\u7f6e $$xy$$ \u8f74\u3002</p> <p>\u5728\u7b2c\u4e00\u7ae0\uff0c\u6211\u4eec\u8fdb\u884c\u7684\u64cd\u4f5c\u5b9e\u9645\u4e0a\u662f\u6cbf $$z$$ \u8f74\u65b9\u5411\u7684\u6b63\u4ea4\u6295\u5f71\uff0c\u76f8\u5f53\u4e8e\u76f4\u63a5\u628a\u6a21\u578b\u538b\u6241\u5230 $$xOy$$ \u9762\u4e0a\u4e86\u3002\u8fd9\u64cd\u4f5c\u5f88\u7b80\u5355\uff0c\u4e5f\u5c31\u662f\u8bf4\u6211\u4eec\u4e0d\u7528\u7ba1 $$z$$ \u8f74\u4e86\uff0c\u800c\u4e14\u770b\u8d77\u6765\u6548\u679c\u8fd8\u884c\u3002</p> <ul> <li> <p>\u516c\u5f0f\uff1a   $$   x_{screen} = x_{model} \\   y_{screen} = y_{model}   $$</p> </li> <li> <p>\u7269\u7406\u610f\u4e49\uff1a\u628a\u4e09\u7ef4\u7269\u4f53\u5782\u76f4\u62cd\u6241\u5728\u5c4f\u5e55\u4e0a\u3002</p> </li> <li> <p>\u89c6\u89c9\u6548\u679c\uff1a\u6ca1\u6709\u900f\u89c6\uff08\u8fd1\u5927\u8fdc\u5c0f\uff09\uff0c\u53ea\u6709\u8f6e\u5ed3\u3002</p> </li> </ul> <p>\u4ee3\u4ef7\u5c31\u662f\u4fe1\u606f\u7684\u4e22\u5931\uff0c\u5728\u53ea\u753b\u7ebf\u7684\u65f6\u5019\u611f\u89c9\u4e0d\u660e\u663e\uff0c\u4f46\u662f\u5982\u679c\u8fdb\u5165\u586b\u5145\u6a21\u5f0f\u8981\u7ed9\u4e09\u89d2\u5f62\u4e0a\u8272\uff0c\u5c31\u4f1a\u51fa\u73b0\u95ee\u9898\u3002\u8fd9\u90e8\u5206\u6211\u4eec\u4f1a\u5728\u540e\u9762\u7684\u7ae0\u8282\u89e3\u51b3\u3002</p> <p>2\u3001\u6211\u4eec\u4f7f\u7528TGAImage\u7684\u65b9\u6cd5<code>void set(const int x, const int y, const TGAColor &amp;c)</code>\u6765\u8bbe\u7f6e $$(x, y)$$ \u70b9\u7684\u50cf\u7d20\u989c\u8272\uff0c\u4f20\u5165\u7684xy\u9700\u8981\u662f\u6574\u5f62\uff0c\u4f46\u662f\u6211\u4eec\u8bfb\u53d6\u5230\u7684\u9876\u70b9\u5750\u6807\u90fd\u662f\u6d6e\u70b9\u578b\u3002\u800c\u4e14\u6253\u5f00obj\u6587\u4ef6\u4f1a\u53d1\u73b0\u9876\u70b9\u7684\u5750\u6807\u90fd\u662f\u5728 $$[-1, 1]$$ \u8303\u56f4\u5185\uff0c\u5982\u679c\u5f3a\u884c\u8f6c\u6362\u6210\u6574\u578b\uff0c\u5c31\u4f1a\u90fd\u53d8\u6210 0 \u3002</p> <p>\u4e3a\u4e86\u8ba9\u5b83\u4eec\u6b63\u786e\u663e\u793a\uff0c\u6211\u4eec\u8981\u628a\u8fd9\u4e9b\u5750\u6807\u5bf9\u5e94\u5230\u5c4f\u5e55\u4e0a\u3002</p> <pre><code>//\u5047\u5982\u6211\u521d\u59cb\u89c4\u5b9a\u4e86\u8fd9\u6837\u5927\u5c0f\u7684\u5c4f\u5e55\nconstexpr int width  = 800;\nconstexpr int height = 800;\nTGAImage framebuffer(width, height, TGAImage::RGB);\n</code></pre> <p>\u8981\u628a $$[-1, 1]$$ \u8303\u56f4\u5185\u7684 $$xy$$ \u5206\u522b\u6620\u5c04\u5230 $$[0, width]$$ \u548c $$[0, height]$$\uff0c\u6211\u4eec\u9700\u8981\u8fdb\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <pre><code>int screen_x0 = static_cast&lt;int&gt;((v0.x + 1.0f) * width / 2.0f);\nint screen_y0 = static_cast&lt;int&gt;((v0.y + 1.0f) * height / 2.0f);\nint screen_x1 = static_cast&lt;int&gt;((v1.x + 1.0f) * width / 2.0f);\nint screen_y1 = static_cast&lt;int&gt;((v1.y + 1.0f) * height / 2.0f);\n</code></pre> <p><code>.obj</code> \u6587\u4ef6\u91cc\u5b58\u50a8\u7684\u9876\u70b9\u5750\u6807 $(x, y, z)$\uff0c\u5176\u5b9e\u662f\u6a21\u578b\u7a7a\u95f4 (Model Space) \u7684\u5750\u6807\uff0c\u4e5f\u88ab\u79f0\u4e3a\u5c40\u90e8\u7a7a\u95f4 (Local Space)\u3002</p> <p>\u4e3a\u4e86\u8ba9\u4f60\u5f7b\u5e95\u7406\u89e3\u8fd9\u610f\u5473\u7740\u4ec0\u4e48\uff0c\u4ee5\u53ca\u5b83\u5728\u540e\u7eed\u8bfe\u7a0b\u4e2d\u7684\u4f4d\u7f6e\uff0c\u6211\u4eec\u53ef\u4ee5\u6253\u4e2a\u6bd4\u65b9\u3002</p> <p>\u5728 TinyRenderer \u7684\u7b2c\u4e00\u7ae0\uff0c\u5176\u5b9e\u505a\u4e86\u4e00\u4e2a\u5de8\u5927\u7684\u7b80\u5316\u3002</p> <p>\u5b8c\u6574\u7684\u56fe\u5f62\u5b66\u6d41\u6c34\u7ebf\uff08Pipeline\uff09\u662f\u8fd9\u6837\u7684\uff1a</p> <ol> <li>\u6a21\u578b\u7a7a\u95f4 (Model Space)\uff1aOBJ \u6587\u4ef6\u91cc\u7684\u539f\u59cb\u6570\u636e\u3002<ul> <li>(\u73b0\u72b6)</li> </ul> </li> <li>\u4e16\u754c\u7a7a\u95f4 (World Space)\uff1a\u4f60\u628a\u4eba\u5076\u6446\u5728\u623f\u95f4\u7684\u89d2\u843d\u91cc\u3002<ul> <li>\u9700\u8981\u4e58\u4ee5 Model Matrix (\u6a21\u578b\u77e9\u9635)\u3002</li> </ul> </li> <li>\u89c2\u5bdf\u7a7a\u95f4 (View Space / Camera Space)\uff1a\u4ee5\u6444\u50cf\u673a\u4e3a\u4e2d\u5fc3\u770b\u8fd9\u4e2a\u4e16\u754c\u3002<ul> <li>\u9700\u8981\u4e58\u4ee5 View Matrix (\u89c6\u56fe\u77e9\u9635)\u3002</li> </ul> </li> <li>\u88c1\u526a\u7a7a\u95f4 (Clip Space) / \u5f52\u4e00\u5316\u8bbe\u5907\u5750\u6807 (NDC)\uff1a\u628a\u89c6\u91ce\u5185\u7684\u4e1c\u897f\u538b\u7f29\u5230 $[-1, 1]$ \u7684\u7acb\u65b9\u4f53\u91cc\u3002<ul> <li>\u9700\u8981\u4e58\u4ee5 Projection Matrix (\u6295\u5f71\u77e9\u9635)\u3002</li> </ul> </li> <li>\u5c4f\u5e55\u7a7a\u95f4 (Screen Space)\uff1a\u628a $[-1, 1]$ \u6620\u5c04\u5230\u50cf\u7d20\u5750\u6807 $[0, 800]$\u3002<ul> <li>(\u521a\u624d\u5199\u7684 <code>(x+1)*width/2</code> \u5c31\u662f\u8fd9\u4e00\u6b65)</li> </ul> </li> </ol> <p>\u73b0\u5728\u7684\u505a\u6cd5\u5b9e\u9645\u4e0a\u662f\uff1a \u5047\u8bbe\u6a21\u578b\u5c31\u653e\u5728\u4e16\u754c\u4e2d\u5fc3 $(0,0,0)$\uff0c\u6444\u50cf\u673a\u6b63\u5bf9\u7740\u5b83\uff0c\u6ca1\u6709\u4efb\u4f55\u65cb\u8f6c\u6216\u4f4d\u79fb\u3002 \u6240\u4ee5\u8df3\u8fc7\u4e86\u4e2d\u95f4\u6240\u6709\u7684\u77e9\u9635\u53d8\u6362\uff0c\u76f4\u63a5\u628a\u6a21\u578b\u7a7a\u95f4\u5f3a\u884c\u5f53\u6210\u4e86NDC\uff08$[-1, 1]$ \u8303\u56f4\uff09\uff0c\u7136\u540e\u4e00\u6b65\u8f6c\u6362\u5230\u4e86\u5c4f\u5e55\u7a7a\u95f4\u3002</p> <pre><code>#include &lt;string&gt;\n#include &lt;iostream&gt;\n#include &lt;vector&gt;\n#include &lt;fstream&gt;\n#include &lt;sstream&gt;\n#include \"../include/model.h\"\n#include \"../include/tgaimage.h\"\n\nconstexpr TGAColor white   = {255, 255, 255, 255}; // attention, BGRA order\nconstexpr TGAColor green   = {  0, 255,   0, 255};\nconstexpr TGAColor red     = {  0,   0, 255, 255};\nconstexpr TGAColor blue    = {255, 128,  64, 255};\nconstexpr TGAColor yellow  = {  0, 200, 255, 255};\n\nvoid draw_line(int x0, int y0, int x1, int y1, TGAImage&amp; framebuffer, TGAColor color) {\n    //\u753b\u7ebf\u6bb5\u7684Bresenham\u7b97\u6cd5\u5b9e\u73b0\n    bool steep = false;\n    steep = (std::abs(x0 - x1) &lt; std::abs(y0 - y1));\n    if (steep) {\n        std::swap(x0, y0);\n        std::swap(x1, y1);\n    }\n    if(x0 &gt; x1) {\n        std::swap(x0, x1);\n        std::swap(y0, y1);\n    }\n    for (int x = x0; x &lt;= x1; x++) {\n        float t = (x - x0) / static_cast&lt;float&gt;(x1 - x0);\n        int y = std::round(y0 + (y1 - y0) * t);\n\n        if (steep) {\n            framebuffer.set(y, x, color);\n        } else {\n            framebuffer.set(x, y, color);\n        }\n    }\n}\n\nint main(int argc, char** argv) {\n    constexpr int width  = 800;\n    constexpr int height = 800;\n    TGAImage framebuffer(width, height, TGAImage::RGB);\n\n    //\u8fd9\u91cc\u53ef\u4ee5\u6539\u6210\u4ece\u547d\u4ee4\u884c\u53c2\u6570\u4f20\u5165\u6a21\u578b\u8def\u5f84\n    Model model(\"F:/VSproject/TinyRenderer/obj/diablo3_pose/diablo3_pose.obj\");\n\n    int num_faces = model.nfaces();\n\n    for (int i = 0; i &lt; num_faces; i++) {\n        for (int j = 0; j &lt; 3; j++) {\n            Vec3f v0 = model.vert(i, j);\n            Vec3f v1 = model.vert(i, (j + 1) % 3);\n            int screen_x0 = static_cast&lt;int&gt;((v0.x + 1.0f) * width / 2.0f);\n            int screen_y0 = static_cast&lt;int&gt;((v0.y + 1.0f) * height / 2.0f);\n            int screen_x1 = static_cast&lt;int&gt;((v1.x + 1.0f) * width / 2.0f);\n            int screen_y1 = static_cast&lt;int&gt;((v1.y + 1.0f) * height / 2.0f);\n            draw_line(screen_x0, screen_y0, screen_x1, screen_y1, framebuffer, red);\n        }\n    }\n\n    framebuffer.write_tga_file(\"framebuffer.tga\");\n    return 0;\n}\n</code></pre>"},{"location":"TinyRenderer/#_3","title":"\u7ed3\u679c\u4e0e\u590d\u76d8","text":""},{"location":"TinyRenderer/#_4","title":"\u7ed3\u679c","text":"<p>\u6211\u4eec\u4f1a\u5f97\u5230\u4ee5\u4e0b\u56fe\u7247\uff1a</p>"},{"location":"TinyRenderer/#_5","title":"\u590d\u76d8","text":"<p>\u6211\u4eec\u5f15\u5165<code>chrono</code>\u5e93\u8fdb\u884c\u8bb0\u65f6\uff0c\u5e76\u4e14\u8ba9\u6838\u5fc3\u7684\u753b\u7ebf\u90e8\u5206\u5faa\u73af1000\u6b21\u3002\u7531\u4e8e\u89e3\u6790 OBJ \u662f\u6587\u4ef6 IO \u64cd\u4f5c\uff0c\u8017\u65f6\u4e14\u89e3\u6790\u540e\u7684\u6570\u636e\u4e0d\u4f1a\u53d8\uff0c\u91cd\u590d\u89e3\u6790\u53ea\u4f1a\u8ba9\u8ba1\u65f6\u7ed3\u679c\u5931\u771f\uff0c\u6240\u4ee5\u4e0d\u653e\u8fdb\u5faa\u73af\u3002</p> <pre><code>int main(int argc, char** argv) {\n\n\n    constexpr int width  = 800;\n    constexpr int height = 800;\n    const int LOOP_TIMES = 1000;\n    TGAImage framebuffer(width, height, TGAImage::RGB);\n\n    //\u8fd9\u91cc\u540e\u7eed\u53ef\u4ee5\u6539\u6210\u4ece\u547d\u4ee4\u884c\u53c2\u6570\u4f20\u5165\u6a21\u578b\u8def\u5f84\n    Model model(\"F:/VSproject/TinyRenderer/obj/diablo3_pose/diablo3_pose.obj\");\n\n    int num_faces = model.nfaces();\n    int num_verts = model.nverts();\n    auto start_time = std::chrono::steady_clock::now();\n    for (int k = 0; k &lt; LOOP_TIMES; k++) {\n        for (int i = 0; i &lt; num_faces; i++) {\n            for (int j = 0; j &lt; 3; j++) {\n                Vec3f v0 = model.vert(i, j);\n                Vec3f v1 = model.vert(i, (j + 1) % 3);\n                int screen_x0 = project(v0.x, width);\n                int screen_y0 = project(v0.y, height);\n                int screen_x1 = project(v1.x, width);\n                int screen_y1 = project(v1.y, height);\n                draw_line(screen_x0, screen_y0, screen_x1, screen_y1, framebuffer, red);\n            }\n        }\n    }\n\n    framebuffer.write_tga_file(\"framebuffer.tga\");\n\n    auto end_time = std::chrono::steady_clock::now();\n    auto duration_ms = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(end_time - start_time).count();\n    auto duration_s = std::chrono::duration_cast&lt;std::chrono::seconds&gt;(end_time - start_time).count();\n    std::cout &lt;&lt; \"\u7a0b\u5e8f\u8fd0\u884c\u5b8c\u6210\uff01\" &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"\u603b\u8fd0\u884c\u65f6\u95f4\uff1a\" &lt;&lt; duration_ms &lt;&lt; \" \u6beb\u79d2\" &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"\u603b\u8fd0\u884c\u65f6\u95f4\uff1a\" &lt;&lt; duration_s &lt;&lt; \" \u79d2\" &lt;&lt; std::endl;\n\n    return 0;\n}\n</code></pre> <p>\u7ed3\u679c\uff1a</p> <p></p> <p>\u5176\u5b9e\u5f88\u660e\u663e\u6211\u4eec\u5728main.cpp\u4e2d\u6709\u81f3\u5c11\u4e09\u4e2a\u53ef\u4ee5\u4f18\u5316\u7684\u70b9</p>"},{"location":"TinyRenderer/#_6","title":"\u7b2c\u4e8c\u6b21\u5c1d\u8bd5","text":"<p>1\u3001\u6211\u7684Bresenham\u7b97\u6cd5\u5b9e\u73b0\u5e76\u4e0d\u662f\u6700\u6807\u51c6\u7684\uff0c\u5b83\u5305\u542b\u4e86\u4e24\u4e2a\u6027\u80fd\u74f6\u9888</p> <pre><code>float t = (x - x0) / static_cast&lt;float&gt;(x1 - x0); // \u6d6e\u70b9\u9664\u6cd5\uff01\u6700\u6162\u7684\u64cd\u4f5c\nint y = std::round(y0 + (y1 - y0) * t);           // \u6d6e\u70b9\u52a0\u6cd5\u3001\u4e58\u6cd5\u3001\u53d6\u6574\n</code></pre> <p>\u5176\u5b9e\u6211\u4eec\u4e0d\u9700\u8981\u7b97\u51fa\u5177\u4f53\u7684 y \u662f\u591a\u5c11\uff0c\u6211\u4eec\u53ea\u9700\u8981\u77e5\u9053\uff1a\u6bcf\u5f53 x \u79fb\u52a8\u4e00\u6b65\uff0cy \u5230\u5e95\u8be5\u4e0d\u8be5\u52a8\u4e00\u6b65\uff1f\u8fd9\u901a\u8fc7\u4e00\u4e2a\u8bef\u5dee\u53d8\u91cf <code>error</code> \u6765\u7d2f\u8ba1 </p> <pre><code>void draw_line(int x0, int y0, int x1, int y1, TGAImage&amp; framebuffer, TGAColor color) {\n    //\u753b\u7ebf\u6bb5\u7684Bresenham\u7b97\u6cd5\u5b9e\u73b0\n    bool steep = false;\n    steep = (std::abs(x0 - x1) &lt; std::abs(y0 - y1));\n    if (steep) {\n        std::swap(x0, y0);\n        std::swap(x1, y1);\n    }\n    if(x0 &gt; x1) {\n        std::swap(x0, x1);\n        std::swap(y0, y1);\n    }\n\n    int dx = x1 - x0;\n    int dy = std::abs(y1 - y0);\n    int error = 0;\n    int ystep = (y0 &lt; y1) ? 1 : -1;\n    int y = y0;\n\n    for (int x = x0; x &lt;= x1; x++) {\n        if (steep) {\n            framebuffer.set(y, x, color);\n        } else {\n            framebuffer.set(x, y, color);\n        }\n\n        // \u539f\u672c\u7684\u659c\u7387\u662f dy/dx\u3002\u5982\u679c\u4e0d\u52a8\u7528\u9664\u6cd5\uff0c\u6211\u4eec\u5c31\u5728 error \u91cc\u7d2f\u52a0 dy\n        // \u5f53 error \u6512\u591f\u4e86\u4e00\u4e2a dx \u65f6\uff0c\u8bf4\u660e y \u8be5\u8d70\u4e00\u6b65\u4e86\n\n        error += dy;\n\n        // \u8fd9\u91cc\u5b9e\u9645\u4e0a\u662f\u628a error \u6269\u5927\u4e86 dx \u500d\u6765\u6bd4\u8f83\uff0c\u907f\u514d\u9664\u6cd5\n        // error &gt;= 0.5 (\u5373 error * 2 &gt;= dx)\n        if (error * 2 &gt;= dx) {\n            y += ystep;\n            error -= dx;// \u8bef\u5dee\u6e05\u96f6\uff08\u51cf\u53bb\u4e00\u4e2a\u5355\u4f4d\uff09\n        }\n    }\n}\n</code></pre> <p>\u518d\u6b21\u8fd0\u884c\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u786e\u5b9e\u53d8\u5feb\u4e86\u4e00\u4e9b</p> <p></p>"},{"location":"TinyRenderer/#_7","title":"\u7b2c\u4e09\u6b21\u5c1d\u8bd5","text":"<p>2\u3001\u4e09\u89d2\u5f62\u91cd\u590d\u8fb9\u3002\u4e00\u4e2a\u5c01\u95ed\u7684 3D \u6a21\u578b\uff0c\u7edd\u5927\u591a\u6570\u8fb9\u90fd\u662f\u4e24\u4e2a\u4e09\u89d2\u5f62\u5171\u7528\u7684\uff0c\u6240\u4ee5\u9700\u8981\u4e00\u4e2a\u201c\u8bb0\u8d26\u672c\u201d\uff0c\u8bb0\u5f55\u54ea\u6761\u8fb9\u5df2\u7ecf\u753b\u8fc7\u4e86\u3002\u5982\u679c\u9047\u5230\u753b\u8fc7\u7684\uff0c\u5c31\u8df3\u8fc7,\u672c\u8d28\u4e0a\u662f\u90a3\u5185\u5b58\u6362\u65f6\u95f4\uff0c\u6ca1\u6709\u514d\u8d39\u7684\u5348\u9910\u3002</p> <p>tips: \u5728\u5b9e\u65f6\u6e32\u67d3\u4e2d\uff0c\u91cd\u590d\u7ed8\u5236 \u786e\u5b9e\u662f\u4e00\u4e2a\u6027\u80fd\u6740\u624b\u3002\u867d\u7136\u5728\u73b0\u5728\u7684 GPU \u786c\u4ef6\u7ba1\u7ebf\u4e2d\uff0c\u7ebf\u6846\u6a21\u5f0f\u901a\u5e38\u76f4\u63a5\u7531\u9a71\u52a8\u5904\u7406\uff0c\u4f46\u5728\u8f6f\u6e32\u67d3\u5668\u4e2d\uff0c\u6bcf\u4e00\u884c\u4ee3\u7801\u7684\u6548\u7387\u90fd\u81f3\u5173\u91cd\u8981\u3002</p> <p>3\u3001\u51e0\u4f55\u8ba1\u7b97\u6d6a\u8d39\u3002\u540c\u4e00\u4e2a\u9876\u70b9\u88ab\u597d\u51e0\u4e2a\u4e09\u89d2\u5f62\u5171\u7528\uff0c\u539f\u6765\u7684\u7b97\u6cd5\u4f1a\u6267\u884c\u597d\u51e0\u6b21\u6295\u5f71\uff08\u5c31\u662f\u628a\u5b83\u653e\u5927\u5230\u5c4f\u5e55\u90a3\u4e00\u6b65\uff09\u3002</p> <p>\u628a\u8fd9\u4e24\u4e2a\u6d6a\u8d39\u653e\u5230\u4e00\u8d77\u662f\u56e0\u4e3a\u5b83\u4eec\u90fd\u5c5e\u4e8e\u91cd\u590d\u52b3\u52a8\u3002\u90a3\u4e48\u6211\u4eec\u73b0\u5728\u6765\u68b3\u7406\u4e00\u4e0b\u601d\u8def\uff1a</p> <p>\u6574\u4e2a\u6e32\u67d3\u8fc7\u7a0b\u88ab\u62c6\u5206\u6210\u4e86\u4e09\u4e2a\u6e05\u6670\u7684\u9636\u6bb5\uff1a</p>"},{"location":"TinyRenderer/#1-topology-pre-processing","title":"\u9636\u6bb5 1\uff1a\u62d3\u6251\u9884\u5904\u7406 (Topology Pre-processing)","text":"<ul> <li>\u4f4d\u7f6e\uff1a\u4e3b\u5faa\u73af\u5916\u90e8\uff08\u53ea\u6267\u884c 1 \u6b21\uff09\u3002</li> <li>\u4efb\u52a1\uff1a\u641e\u6e05\u695a\u201c\u5230\u5e95\u6709\u591a\u5c11\u6761\u552f\u4e00\u7684\u8fb9\u201d\u3002</li> <li>\u903b\u8f91\uff1a<ol> <li>\u904d\u5386\u6240\u6709\u9762\uff0c\u628a <code>(u, v)</code> \u548c <code>(v, u)</code> \u7edf\u4e00\u683c\u5f0f\u5316\u4e3a <code>(min, max)</code>\u3002</li> <li>\u5168\u90e8\u6254\u8fdb\u4e00\u4e2a <code>vector</code>\u3002</li> <li>Sort\uff08\u6392\u5e8f\uff09\uff1a\u628a\u76f8\u540c\u7684\u8fb9\u6392\u5728\u4e00\u8d77\u3002</li> <li>Unique\uff08\u53bb\u91cd\uff09\uff1a\u5254\u9664\u91cd\u590d\u7684\u8fb9\u3002</li> </ol> </li> </ul> <pre><code>#include &lt;cmath&gt;\n#include &lt;algorithm&gt;\n//......\n\nstruct Edge {\n    int u, v;\n    //\u91cd\u8f7d &lt; \u8fd0\u7b97\u7b26\uff0c\u7528\u4e8e sort\n    bool operator&lt;(const Edge&amp; other) const {\n        if (u != other.u) return u &lt; other.u;\n        return v &lt; other.v;\n    }\n    //\u91cd\u8f7d == \u8fd0\u7b97\u7b26\uff0c\u7528\u4e8e\u5224\u65ad\u91cd\u590d\n    bool operator==(const Edge&amp; other) const {\n        return u == other.u &amp;&amp; v == other.v;\n    }\n};\n\nvoid draw_line(int x0, int y0, int x1, int y1, TGAImage&amp; framebuffer, TGAColor color) {\n    //......\n}\n\n//\u628a\u6295\u5f71\u5230\u5c4f\u5e55\u7684\u90e8\u5206\u5355\u72ec\u62ff\u51fa\u6765\u7684\u4e00\u4e2a\u51fd\u6570\n//worh: width or height\nint project(float pos, int worh) {\n    int screen_pos = static_cast&lt;int&gt;((pos + 1.0f) * worh / 2.0f);\n    return screen_pos;\n}\n\nint main(int argc, char** argv) {\n    //......\n    int num_faces = model.nfaces();\n    int num_verts = model.nverts();\n    std::vector&lt;Edge&gt; unique_edges;\n    unique_edges.reserve(num_faces * 3);\n    auto start_time = std::chrono::steady_clock::now();\n\n    for(int i = 0; i &lt; num_faces; i++) {\n        for(int j = 0; j &lt; 3; j++) {\n            int v0_idx = model.vert_idx(i, j % 3);\n            int v1_idx = model.vert_idx(i, (j + 1) % 3);\n            if(v0_idx &gt; v1_idx) std::swap(v0_idx, v1_idx);\n            Edge edge = {v0_idx, v1_idx};\n            unique_edges.push_back(edge);\n        }\n    }\n\n    std::sort(unique_edges.begin(), unique_edges.end());\n    auto last = std::unique(unique_edges.begin(), unique_edges.end());\n    unique_edges.erase(last, unique_edges.end());\n\n    std::cout &lt;&lt; \"Original edges: \" &lt;&lt; model.nfaces() * 3 &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"Unique edges:   \" &lt;&lt; unique_edges.size() &lt;&lt; std::endl;\n    //......\n}\n</code></pre>"},{"location":"TinyRenderer/#2-vertex-processing","title":"\u9636\u6bb5 2\uff1a\u9876\u70b9\u7740\u8272 (Vertex Processing)","text":"<ul> <li>\u4f4d\u7f6e\uff1a\u6e32\u67d3\u5faa\u73af\u5185\u90e8\uff08\u6bcf\u4e00\u5e27\u6267\u884c\uff09\u3002</li> <li>\u4efb\u52a1\uff1a\u8ba1\u7b97\u6240\u6709\u9876\u70b9\u5728\u5c4f\u5e55\u4e0a\u7684\u4f4d\u7f6e\u3002</li> <li>\u903b\u8f91\uff1a<ol> <li>\u521b\u5efa\u4e00\u4e2a\u5927\u5c0f\u4e3a <code>num_verts</code> \u7684\u6570\u7ec4 <code>screen_coords</code>\u3002</li> <li>\u904d\u5386 <code>0</code> \u5230 <code>num_verts</code>\u3002</li> <li>\u5bf9\u6bcf\u4e2a\u70b9\u505a <code>project</code>\uff0c\u7ed3\u679c\u5b58\u5165\u6570\u7ec4\u3002</li> </ol> </li> <li>\u5173\u952e\u70b9\uff1a\u8fd9\u91cc\u7528\u7684\u662f <code>num_verts</code> \u5faa\u73af\uff0c\u6bcf\u4e2a\u9876\u70b9\u53ea\u8ba1\u7b97\u4e00\u6b21\uff0c\u7edd\u65e0\u6d6a\u8d39\u3002 </li> </ul> <pre><code>std::vector&lt;Vec2i&gt; screen_coords(num_verts);\n\n\nfor (int k = 0; k &lt; LOOP_TIMES; k++) {\n    for (int i = 0; i &lt; num_verts; i++) {\n        Vec3f v = model.vert(i);\n        screen_coords[i].x = project(v.x, width);\n        screen_coords[i].y = project(v.y, height);\n    }\n\n\n    for (const auto&amp; edge : unique_edges) {\n\n\n        Vec2i p0 = screen_coords[edge.u];\n        Vec2i p1 = screen_coords[edge.v];\n\n        //\u8fd9\u91cc\u5176\u5b9e\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a\u88c1\u526a\u68c0\u67e5\n        //if (p0.x &lt; 0 || p0.x &gt;= width || p0.y &lt; 0 ...) continue;\n\n        draw_line(p0.x, p0.y, p1.x, p1.y, framebuffer, red);\n    }\n}\n</code></pre>"},{"location":"TinyRenderer/#3-rasterization-drawing","title":"\u9636\u6bb5 3\uff1a\u5149\u6805\u5316 (Rasterization / Drawing)","text":"<ul> <li>\u4f4d\u7f6e\uff1a\u6e32\u67d3\u5faa\u73af\u5185\u90e8\uff08\u6bcf\u4e00\u5e27\u6267\u884c\uff09\u3002</li> <li>\u4efb\u52a1\uff1a\u8fde\u7ebf\u3002</li> <li>\u903b\u8f91\uff1a<ol> <li>\u904d\u5386\u90a3\u4efd\u201c\u53bb\u91cd\u540e\u7684\u8fb9\u5217\u8868\u201d (<code>unique_edges</code>)\u3002</li> <li>\u6839\u636e\u7d22\u5f15 <code>u</code> \u548c <code>v</code>\uff0c\u76f4\u63a5\u53bb <code>screen_coords</code> \u6570\u7ec4\u91cc\u67e5\u8868\u62ff\u5750\u6807\u3002</li> <li>\u8c03\u7528 <code>draw_line</code>\u3002</li> </ol> </li> <li>\u5173\u952e\u70b9\uff1a\u53ea\u753b\u5fc5\u987b\u753b\u7684\u7ebf\uff0c\u6ca1\u6709\u91cd\u590d\u52b3\u52a8\u3002</li> </ul> <p>\u5047\u8bbe\u6211\u4eec\u6709\u7684diablo\u6a21\u578b\u662f\u4e00\u4e2a\u6807\u51c6\u7684\u5c01\u95ed 3D \u6a21\u578b\u3002 \u6839\u636e\u6b27\u62c9\u793a\u6027\u6570\u548c\u56fe\u5f62\u5b66\u7edf\u8ba1\u89c4\u5f8b\uff0c\u5bf9\u4e8e\u5c01\u95ed\u4e09\u89d2\u7f51\u683c\uff1a</p> <ul> <li>\u9876\u70b9\u6570 (V)</li> <li>\u9762\u6570 (F) $\\approx 2V$</li> <li>\u8fb9\u6570 (E) $\\approx 3V$</li> </ul> <p>\u6211\u4eec\u6765\u770b\u770b\u4f18\u5316\u524d\u540e\u7684\u8fd0\u7b97\u91cf\u5bf9\u6bd4\uff1a</p>"},{"location":"TinyRenderer/#1-projection-math","title":"1. \u6295\u5f71\u8ba1\u7b97 (Projection Math)","text":"<p>\u8fd9\u662f\u6d6e\u70b9\u8fd0\u7b97\uff0c\u6bd4\u8f83\u8017\u65f6\u3002</p> <ul> <li>\u4f18\u5316\u524d\uff08\u6309\u9762\u904d\u5386\uff09\uff1a<ul> <li>\u903b\u8f91\uff1a<code>for i in faces: for j in 0..2: project(vert)</code></li> <li>\u6b21\u6570\uff1a$3 \\times F \\approx 3 \\times 2V = \\mathbf{6V}$ \u6b21</li> </ul> </li> <li>\u4f18\u5316\u540e\uff08\u6309\u70b9\u904d\u5386\uff09\uff1a<ul> <li>\u903b\u8f91\uff1a<code>for i in verts: project(vert)</code></li> <li>\u6b21\u6570\uff1a$1 \\times V = \\mathbf{1V}$ \u6b21</li> </ul> </li> <li>\u7ed3\u8bba\uff1a\u6295\u5f71\u8ba1\u7b97\u91cf\u51cf\u5c11\u4e86 6 \u500d\uff01\uff08\u56e0\u4e3a\u5e73\u5747\u6bcf\u4e2a\u9876\u70b9\u88ab 6 \u4e2a\u4e09\u89d2\u5f62\u5171\u7528\uff09\u3002</li> </ul>"},{"location":"TinyRenderer/#2-draw-call","title":"2. \u753b\u7ebf\u64cd\u4f5c (Draw Call)","text":"<p>\u8fd9\u662f\u6574\u6570\u8fd0\u7b97\u548c\u5185\u5b58\u5199\u5165\uff0c\u4e5f\u975e\u5e38\u8017\u65f6\u3002</p> <ul> <li>\u4f18\u5316\u524d\uff08\u6309\u9762\u753b\u7ebf\uff09\uff1a<ul> <li>\u903b\u8f91\uff1a\u6bcf\u4e2a\u4e09\u89d2\u5f62\u753b 3 \u6761\u8fb9\u3002</li> <li>\u6b21\u6570\uff1a$3 \\times F \\approx 6V$ \u6761\u7ebf\u3002</li> <li>\u6ce8\uff1a\u56e0\u4e3a\u6bcf\u6761\u8fb9\u662f\u4e24\u4e2a\u9762\u5171\u7528\u7684\uff0c\u6240\u4ee5\u6bcf\u6761\u8fb9\u88ab\u753b\u4e86 2 \u6b21\u3002</li> </ul> </li> <li>\u4f18\u5316\u540e\uff08\u6309\u552f\u4e00\u8fb9\u753b\u7ebf\uff09\uff1a<ul> <li>\u903b\u8f91\uff1a\u53ea\u753b <code>unique_edges</code>\u3002</li> <li>\u6b21\u6570\uff1a$1 \\times E \\approx \\mathbf{3V}$ \u6761\u7ebf\u3002</li> </ul> </li> <li>\u7ed3\u8bba\uff1a\u753b\u7ebf\u6b21\u6570\u51cf\u5c11\u4e86 2 \u500d\uff01</li> </ul>"},{"location":"TinyRenderer/#_8","title":"\u6700\u540e\u901f\u5ea6","text":"<p>\u6211\u7684\u7535\u8111\u7684cpu\u662fi7-12650\uff0c\u4e0d\u540c\u7535\u8111\u8fd0\u884c\u901f\u5ea6\u4e0d\u540c\uff0c\u4f46\u660e\u663e\u6bd4\u524d\u9762\u7684\u5feb\u5f97\u591a\u3002</p> <p>\u6700\u540e\u522b\u5fd8\u4e86\u5220\u6389\u6d4b\u8bd5\u7528\u7684\u5faa\u73af\u3002</p>"},{"location":"TinyRenderer/#maincpp_1","title":"\u6700\u7ec8\u7684main.cpp","text":"<pre><code>#include &lt;string&gt;\n#include &lt;iostream&gt;\n#include &lt;vector&gt;\n#include &lt;fstream&gt;\n#include &lt;chrono&gt;\n#include &lt;sstream&gt;\n#include &lt;cmath&gt;\n#include &lt;algorithm&gt;\n#include \"../include/model.h\"\n#include \"../include/tgaimage.h\"\n\nconstexpr TGAColor white   = {255, 255, 255, 255}; // attention, BGRA order\nconstexpr TGAColor green   = {  0, 255,   0, 255};\nconstexpr TGAColor red     = {  0,   0, 255, 255};\nconstexpr TGAColor blue    = {255, 128,  64, 255};\nconstexpr TGAColor yellow  = {  0, 200, 255, 255};\n\nstruct Edge {\n    int u, v;\n    //\u91cd\u8f7d &lt; \u8fd0\u7b97\u7b26\uff0c\u7528\u4e8e sort\n    bool operator&lt;(const Edge&amp; other) const {\n        if (u != other.u) return u &lt; other.u;\n        return v &lt; other.v;\n    }\n    //\u91cd\u8f7d == \u8fd0\u7b97\u7b26\uff0c\u7528\u4e8e\u5224\u65ad\u91cd\u590d\n    bool operator==(const Edge&amp; other) const {\n        return u == other.u &amp;&amp; v == other.v;\n    }\n};\n\nvoid draw_line(int x0, int y0, int x1, int y1, TGAImage&amp; framebuffer, TGAColor color) {\n    //\u753b\u7ebf\u6bb5\u7684Bresenham\u7b97\u6cd5\u5b9e\u73b0\n    bool steep = false;\n    steep = (std::abs(x0 - x1) &lt; std::abs(y0 - y1));\n    if (steep) {\n        std::swap(x0, y0);\n        std::swap(x1, y1);\n    }\n    if(x0 &gt; x1) {\n        std::swap(x0, x1);\n        std::swap(y0, y1);\n    }\n\n    int dx = x1 - x0;\n    int dy = std::abs(y1 - y0);\n    int error = 0;\n    int ystep = (y0 &lt; y1) ? 1 : -1;\n    int y = y0;\n\n    for (int x = x0; x &lt;= x1; x++) {\n        if (steep) {\n            framebuffer.set(y, x, color);\n        } else {\n            framebuffer.set(x, y, color);\n        }\n\n        error += dy;\n\n        if (error * 2 &gt;= dx) {\n            y += ystep;\n            error -= dx;\n        }\n    }\n}\n\n//worh: width or height\nint project(float pos, int worh) {\n    int screen_pos = static_cast&lt;int&gt;((pos + 1.0f) * worh / 2.0f);\n    return screen_pos;\n}\nint main(int argc, char** argv) {\n\n\n    constexpr int width  = 800;\n    constexpr int height = 800;\n    TGAImage framebuffer(width, height, TGAImage::RGB);\n\n    //\u8fd9\u91cc\u540e\u7eed\u53ef\u4ee5\u6539\u6210\u4ece\u547d\u4ee4\u884c\u53c2\u6570\u4f20\u5165\u6a21\u578b\u8def\u5f84\n    Model model(\"F:/VSproject/TinyRenderer/obj/diablo3_pose/diablo3_pose.obj\");\n\n    int num_faces = model.nfaces();\n    int num_verts = model.nverts();\n    std::vector&lt;Edge&gt; unique_edges;\n    unique_edges.reserve(num_faces * 3);\n    auto start_time = std::chrono::steady_clock::now();\n\n    for(int i = 0; i &lt; num_faces; i++) {\n        for(int j = 0; j &lt; 3; j++) {\n            int v0_idx = model.vert_idx(i, j % 3);\n            int v1_idx = model.vert_idx(i, (j + 1) % 3);\n            if(v0_idx &gt; v1_idx) std::swap(v0_idx, v1_idx);\n            Edge edge = {v0_idx, v1_idx};\n            unique_edges.push_back(edge);\n        }\n    }\n\n    std::sort(unique_edges.begin(), unique_edges.end());\n    auto last = std::unique(unique_edges.begin(), unique_edges.end());\n    unique_edges.erase(last, unique_edges.end());\n\n    std::cout &lt;&lt; \"Original edges: \" &lt;&lt; model.nfaces() * 3 &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"Unique edges:   \" &lt;&lt; unique_edges.size() &lt;&lt; std::endl;\n\n    std::vector&lt;Vec2i&gt; screen_coords(num_verts);\n\n\n\n    for (int i = 0; i &lt; num_verts; i++) {\n        Vec3f v = model.vert(i);\n        screen_coords[i].x = project(v.x, width);\n        screen_coords[i].y = project(v.y, height);\n    }\n\n\n    for (const auto&amp; edge : unique_edges) {\n\n\n        Vec2i p0 = screen_coords[edge.u];\n        Vec2i p1 = screen_coords[edge.v];\n\n        // \u7b80\u5355\u7684\u88c1\u526a\u68c0\u67e5\uff08\u53ef\u9009\uff0c\u9632\u6b62\u753b\u51fa\u754c\u5d29\u6e83\uff09\n        // if (p0.x &lt; 0 || p0.x &gt;= width || p0.y &lt; 0 ...) continue;\n\n        draw_line(p0.x, p0.y, p1.x, p1.y, framebuffer, red);\n    }\n\n\n    framebuffer.write_tga_file(\"framebuffer.tga\");\n\n    auto end_time = std::chrono::steady_clock::now();\n    auto duration_ms = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(end_time - start_time).count();\n    auto duration_s = std::chrono::duration_cast&lt;std::chrono::seconds&gt;(end_time - start_time).count();\n    std::cout &lt;&lt; \"\u7a0b\u5e8f\u8fd0\u884c\u5b8c\u6210\uff01\" &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"\u603b\u8fd0\u884c\u65f6\u95f4\uff1a\" &lt;&lt; duration_ms &lt;&lt; \" \u6beb\u79d2\" &lt;&lt; std::endl;\n    std::cout &lt;&lt; \"\u603b\u8fd0\u884c\u65f6\u95f4\uff1a\" &lt;&lt; duration_s &lt;&lt; \" \u79d2\" &lt;&lt; std::endl;\n\n    return 0;\n}\n</code></pre>"},{"location":"TinyRenderer/#triangle-rasterization","title":"Triangle Rasterization","text":"<p>\u7b80\u5355\u6765\u8bf4\uff0c\u672c\u8282\u76ee\u6807\u662f\u5728\u5c4f\u5e55\u4e0a\u586b\u5145\u4e09\u89d2\u5f62\u7ebf\u6846\u3002</p> <p>\u9010\u884c\u626b\u63cf\u6e32\u67d3\u5728\u6b64\u4e0d\u4f5c\u8d58\u8ff0\uff0c\u6211\u4eec\u628a\u76ee\u5149\u653e\u5230\u5305\u56f4\u76d2\u7684\u6784\u9020\u548c\u5224\u65ad\u70b9\u5728\u4e09\u89d2\u5f62\u5185\u5916\u7684\u65b9\u6cd5\u3002</p>"},{"location":"TinyRenderer/#bounding-box","title":"\u5305\u56f4\u76d2\uff08Bounding Box\uff09","text":"<p>\u5982\u679c\u6211\u4eec\u8fd0\u884c\u521d\u59cb\u63d0\u4ea4\uff0c\u4f1a\u5f97\u5230\u4e0b\u56fe\uff1a</p> <p></p> <p>\u73b0\u5728\u6211\u4eec\u8981\u6765\u586b\u5145\u8fd9\u51e0\u4e2a\u7ebf\u6846\uff0c\u5f88\u663e\u7136\uff0c\u6211\u4eec\u9700\u8981\u5224\u65ad\u54ea\u4e9b\u70b9\u662f\u5728\u4e09\u89d2\u5f62\u5185\u90e8\u3002\u4f46\u662f\u5982\u679c\u626b\u63cf\u6574\u4e2a\u5c4f\u5e55\uff0c\u4f1a\u9020\u6210\u5f88\u5927\u7684\u6d6a\u8d39\uff0c\u56e0\u4e3a\u8fd9\u5f20\u56fe\u91cc\u5927\u90e8\u5206\u90fd\u662f\u9ed1\u8272\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4e0d\u53ef\u4ee5\u5148\u5927\u81f4\u786e\u5b9a\u4e00\u4e0b\u4e09\u89d2\u5f62\u7684\u8303\u56f4\uff0c\u7136\u540e\u518d\u5224\u65ad\u70b9\u662f\u5426\u5728\u4e09\u89d2\u5f62\u5185\u5185\u90e8\u5462\uff1f\u4ece\u8fd9\u91cc\u5f15\u5165 \u5305\u56f4\u76d2 \u3002</p>"},{"location":"TinyRenderer/#aabbaxis-aligned-bounding-box","title":"AABB\uff08Axis-Aligned Bounding Box \u8f74\u5bf9\u9f50\u5305\u56f4\u76d2\uff09","text":"<p>\u8fd9\u662f tinyrenderer \u4e2d\u5b9e\u73b0\u7684\u65b9\u5f0f\u3002\u987e\u540d\u601d\u4e49\uff0c\u8f74\u5bf9\u9f50\u5305\u56f4\u76d2\u5c31\u662f\u786e\u5b9a\u51fa\u4e00\u4e2a\u77e9\u5f62\uff0c\u77e9\u5f62\u7684\u4e24\u6761\u8fb9\u4e0exy\u5750\u6807\u8f74\u5206\u522b\u5e73\u884c\uff0c\u753b\u51fa\u6765\u957f\u8fd9\u6837\uff1a</p> <p></p> <p>\u5b9e\u73b0\u65b9\u5f0f\u4e5f\u5f88\u7b80\u5355</p> <pre><code>double signed_triangle_area(int ax, int ay, int bx, int by, int cx, int cy) {\n    return .5 * ((by - ay) * (bx + ax) + (cy - by) * (cx + bx) + (ay - cy) * (ax + cx));\n}\n\nvoid triangle(int ax, int ay, int bx, int by, int cx, int cy, TGAImage&amp; framebuffer, TGAColor color) {\n    int bboxmin_x = std::min({ ax, bx, cx });\n    int bboxmax_x = std::max({ ax, bx, cx });\n    int bboxmin_y = std::min({ ay, by, cy });\n    int bboxmax_y = std::max({ ay, by, cy });\n    double total_area = signed_triangle_area(ax, ay, bx, by, cx, cy);\n    if (total_area &lt; 1)return;\n\n    for(int x = bboxmax_x; x &gt;= bboxmin_x; x--) {\n        for(int y = bboxmax_y; y &gt;= bboxmin_y; y--) {\n            double alpha = signed_triangle_area(x, y, bx, by, cx, cy) / total_area;\n            if (alpha &lt; 0)continue;\n\n            double beta = signed_triangle_area(ax, ay, x, y, cx, cy) / total_area;\n            if (beta &lt; 0)continue;\n\n            double gamma = signed_triangle_area(ax, ay, bx, by, x, y) / total_area;\n            if (gamma &lt; 0)continue;\n\n            framebuffer.set(x, y, color);\n            //\u8fd9\u91cc\u7684\u8f93\u51fa\u7ed3\u679c\u662f\u4e09\u89d2\u5f62\uff0c\u800c\u4e0d\u662f\u5305\u56f4\u76d2\uff0c\u8981\u5f97\u5230\u4e0a\u56fe\u7684\u5305\u56f4\u76d2\u7684\u8bdd\uff0c\u76f4\u63a5set\u4e0d\u9700\u8981\u5224\u65ad\n\n        }\n    }\n}\n</code></pre> <p>\u786e\u5b9e\u9700\u8981\u5224\u65ad\u7684\u70b9\u53d8\u5c11\u4e86\uff0c\u4f46\u662f\u8fd9\u79cd\u5305\u56f4\u76d2\u4f1a\u6709\u4e00\u4e2a\u95ee\u9898\u3002\u8bf7\u770b\u767d\u8272\u7684\u8fd9\u4e2a\u72ed\u957f\u7684\u4e09\u89d2\u5f62\uff0c\u867d\u7136\u5b83\u7684\u9762\u79ef\u4e0d\u5927\uff0c\u4f46\u662f\u4f1a\u751f\u6210\u4e00\u4e2a\u5f88\u5927\u7684AABB\uff0c\u56e0\u6b64\u6211\u4eec\u6709\u522b\u7684\u79cd\u7c7b\u7684\u5305\u56f4\u76d2\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <pre><code>for (int i = 0; i &lt; LOOP_TIMES; i++) {\n\n    for (int i = 0; i &lt; model.nfaces(); i++) {\n        Vec3f v0 = model.vert(model.vert_idx(i, 0));\n        Vec3f v1 = model.vert(model.vert_idx(i, 1));\n        Vec3f v2 = model.vert(model.vert_idx(i, 2));\n        int ax = project(v0.x, width);\n        int ay = project(v0.y, height);\n        int bx = project(v1.x, width);\n        int by = project(v1.y, height);\n        int cx = project(v2.x, width);\n        int cy = project(v2.y, height);\n        TGAColor rnd;\n\n        for (int c = 0; c &lt; 3; c++) rnd[c] = std::rand() % 255;\n\n        triangle(ax, ay, bx, by, cx, cy, framebuffer, rnd);\n    }\n}\n</code></pre> <p>\u5728\u7ee7\u7eed\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u8bb0\u5f55\u4e00\u4e0b\u7528 AABB + \u91cd\u5fc3\u5750\u6807 \u5faa\u73af1000\u6b21\u6240\u9700\u7684\u65f6\u95f4\uff0c\u7528diablo\u6a21\u578b</p> <p></p>"},{"location":"TinyRenderer/#obb-oriented-bounding-box","title":"OBB (Oriented Bounding Box \u65b9\u5411\u5305\u56f4\u76d2)","text":"<p>OBB\u901a\u5e38\u7528\u4e8e\u5bf9\u7cbe\u5ea6\u6709\u8981\u6c42\uff0c\u4e14\u7269\u4f53\u4f1a\u53d1\u751f\u65cb\u8f6c\u7684\u957f\u6761\u5f62\u6216\u6241\u5e73\u7269\u4f53\uff0c\u56e0\u6b64\u5728\u8f6f\u5149\u6805\u4e2d\u7528\u4e86\u53ef\u80fd\u4f1a\u66f4\u6162\uff08\u81f3\u5c11\u6211\u5c1d\u8bd5\u7684\u65b9\u6cd5\u662f\u8fd9\u6837\uff09\uff0c\u4f46\u8fd8\u662f\u548c\u5927\u5bb6\u5206\u4eab\u4e00\u4e0b\u6211\u7684\u601d\u8def\u3002</p> <p>OBB\uff08Oriented Bounding Box\uff09\u662f\u53ef\u4ee5\u4efb\u610f\u65cb\u8f6c\u7684\u77e9\u5f62\uff082D\uff09/ \u957f\u65b9\u4f53\uff083D\uff09\uff0c\u5176\u8fb9\u4e0d\u5f3a\u5236\u4e0e\u5750\u6807\u8f74\u5bf9\u9f50\uff0c\u800c\u662f\u4e0e\u88ab\u5305\u56f4\u7269\u4f53\u7684 \u201c\u4e3b\u8f74\u201d \u5bf9\u9f50\uff0c\u56e0\u6b64\u80fd\u66f4\u7d27\u51d1\u5730\u8d34\u5408\u7269\u4f53\u5f62\u72b6\uff0c\u5927\u5e45\u51cf\u5c11\u65e0\u6548\u50cf\u7d20\u3002</p> <p>OBB\u6709\u4e09\u5927\u6838\u5fc3\u8981\u7d20\uff1a</p> <p>\u51e0\u4f55\u4e2d\u5fc3\uff1aOBB \u7684\u4e2d\u5fc3\u70b9\uff08\u50cf\u7d20\u5750\u6807\uff0c\u6574\u6570\uff09\uff0c\u662f\u5305\u56f4\u76d2\u7684 \u201c\u951a\u70b9\u201d\uff0c\u7531\u4e09\u89d2\u5f62\u9876\u70b9\u7684\u5e73\u5747\u5750\u6807\u8ba1\u7b97\u800c\u6765</p> <p>\u6b63\u4ea4\u8f74\u5411\uff1a2 \u4e2a\u6b63\u4ea4\uff08\u5782\u76f4\uff09+ \u5355\u4f4d\u957f\u5ea6\u7684\u5411\u91cf\uff0c\u5b9a\u4e49 OBB \u7684\u671d\u5411\uff08\u6bd4\u5982\u6cbf\u4e09\u89d2\u5f62\u6700\u957f\u8fb9\u7684\u65b9\u5411\uff09\uff1b2D \u573a\u666f\u53ea\u9700 2 \u4e2a\u8f74\u5411\uff0c\u4e14\u5fc5\u987b\u5782\u76f4\u3002</p> <p>\u534a\u957f\uff08\u534a\u5c3a\u5bf8\uff09\uff1a\u6bcf\u4e2a\u8f74\u5411\u7684 \u201c\u534a\u957f\u5ea6\u201d\uff08\u6574\u6570\uff0c\u50cf\u7d20\u6570\uff09\uff0c\u5373\u4ece\u4e2d\u5fc3\u5230\u8be5\u8f74\u5411\u5bf9\u5e94\u8fb9\u7684\u8ddd\u79bb\u3002</p> <p>\u63a5\u4e0b\u6765\u6211\u8bb2\u7684\u662f\u6211\u6784\u9020\u7684\u7b80\u5316\u76842D OBB\u3002 \u5728\u8fd9\u4e2acommit\u4e2d\uff0c\u53ef\u4ee5\u627e\u5230\u6240\u6709\u4ee3\u7801\uff0c\u4e0d\u8fdb\u884c\u5b8c\u6574\u7684\u590d\u5236\u7c98\u8d34\u3002</p> <p>\u6211\u6700\u540e\u4f7f\u7528\u7684\u662f \u4e3b\u6210\u5206\u5206\u6790\uff08PCA\uff09\u6cd5\u6765\u8ba1\u7b97obb\uff0c\u53ef\u4ee5\u9605\u8bfb\u8fd9\u7bc7\u6587\u7ae0\u6765\u5f97\u77e5\u5927\u81f4\u601d\u8def\u3002</p> <p>\u8fd9\u7bc7\u6587\u7ae0\u63d0\u4f9b\u4e86\u5947\u5f02\u503c\u5206\u89e3\uff08SVD\uff09\u7684\u4e25\u8c28\u63a8\u5bfc\uff0c\u6211\u5728\u6413\u7ebf\u6027\u4ee3\u6570\u5e93\u7684\u65f6\u5019\u6709\u53c2\u8003</p> <p>\u6211\u53bb<code>vector.h</code>\u4e2d\u91cd\u8f7d\u4e86\u57fa\u672c\u7684\u8fd0\u7b97\u7b26\uff0c\u5b9e\u73b0\u4e86\u52a0\u51cf\u4e58\u9664\u3001\u70b9\u4e58\u3001\u53c9\u4e58\u3001\u53d6\u6a21\u3001\u5f52\u4e00\u5316\uff0c\u6dfb\u52a0\u4e86\u4e8c\u7ef4\u6d6e\u70b9\u77e9\u9635\uff0c\u4ee5\u53ca\u76f8\u5173\u8fd0\u7b97\uff0c\u6c42\u7279\u5f81\u503c\u7b49</p> <p>\u7531\u4e8e\u76ee\u524d\u6211\u4eec\u6682\u65f6\u4e0d\u8003\u8651\u6df1\u5ea6\uff0c\u6240\u4ee5\u6211\u6784\u9020\u4e86\u4e00\u4e2a\u4e8c\u7ef4\u7684\u7b80\u5316\u7684<code>OBB2D.h</code>\uff0c\u5177\u4f53\u7684\u5b9e\u73b0\u53ef\u4ee5\u53bb\u4ed3\u5e93\u770b\uff1a</p> <pre><code>#pragma once\n\n#include &lt;vector&gt;\n#include \"../include/vector.h\"\n#include &lt;algorithm&gt;\n\nstruct OBB2D {\n    Vec2f center;          // OBB\u5305\u56f4\u76d2\u4e2d\u5fc3\u5750\u6807\n    Vec2f axes[2];         // OBB\u7684\u4e24\u4e2a\u6b63\u4ea4\u8f74\n    float halfExtents[2];  // \u534a\u957f/\u534a\u5bbd\n\n    // \u6784\u9020\u9ed8\u8ba4\u7684\u5305\u56f4\u76d2\n    OBB2D();\n\n    // \u6839\u636e\u63d0\u4f9b\u53c2\u6570\u6784\u9020\u5305\u56f4\u76d2\n    OBB2D(const Vec2f&amp; center, float width, float height, float rotationRad);\n\n    // \u6839\u636e\u63d0\u4f9b\u7684\u70b9\u6784\u9020\u5305\u56f4\u76d2\n    OBB2D(const std::vector&lt;Vec2f&gt;&amp; points);\n\n    // \u8fd4\u56de\u5305\u56f4\u76d2\u7684\u56db\u4e2a\u9876\u70b9\n    std::vector&lt;Vec2f&gt; getCorners() const;\n\n    // \u5224\u65ad\u70b9\u662f\u5426\u5728\u76d2\u5185\n    bool containsPoint(const Vec2f&amp; point) const;\n\n    // \u5224\u65ad\u5305\u56f4\u76d2\u662f\u5426\u76f8\u4ea4\n    bool Intersects(const OBB2D&amp; other) const;\n\n    // \u79fb\u52a8\u5305\u56f4\u76d2\n    void MoveTo(const Vec2f&amp; newCenter);\n\n    // \u65cb\u8f6c\u5305\u56f4\u76d2\n    void Rotate(float angleRad);\n};\n</code></pre> <p>\u6211\u628a\u5b83\u7528\u5728\u4e86 <code>triangle</code>\u51fd\u6570\u4e2d\uff1a</p> <pre><code>void triangle(int ax, int ay, int bx, int by, int cx, int cy, TGAImage&amp; framebuffer, TGAColor color) {\n\n    int bboxmin_x = std::min({ ax, bx, cx });\n    int bboxmax_x = std::max({ ax, bx, cx });\n    int bboxmin_y = std::min({ ay, by, cy });\n    int bboxmax_y = std::max({ ay, by, cy });\n    double total_area = signed_triangle_area(ax, ay, bx, by, cx, cy);\n    if (total_area &lt; 1)return;\n\n\n    // \u7b56\u7565\uff1a\u53ea\u6709\u5f53 AABB \u7684\u9762\u79ef\u8fdc\u5927\u4e8e\u4e09\u89d2\u5f62\u9762\u79ef\u65f6\uff0c\u624d\u503c\u5f97\u82b1\u7b97\u529b\u53bb\u6784\u5efa OBB\n    // \u5426\u5219\uff0c\u6784\u5efa OBB \u7684\u5f00\u9500\u6bd4\u76f4\u63a5\u7b97\u91cd\u5fc3\u5750\u6807\u8fd8\u8981\u5927\n    double aabb_area = (bboxmax_x - bboxmin_x) * (bboxmax_y - bboxmin_y);\n\n    bool use_obb_culling = false;\n\n    OBB2D triOBB;\n\n    //\u5982\u679c AABB \u9762\u79ef\u662f\u4e09\u89d2\u5f62\u7684 3 \u500d\u4ee5\u4e0a\uff0c\u8bf4\u660e\u4e09\u89d2\u5f62\u5f88\u7ec6\u957f/\u503e\u659c\uff0c\u542f\u7528 OBB \u5254\u9664\n    if ((aabb_area / total_area) &gt; 3.0) {\n        std::vector&lt;Vec2f&gt; pts;\n        pts.reserve(3);\n        pts.emplace_back((float)ax, (float)ay);\n        pts.emplace_back((float)bx, (float)by);\n        pts.emplace_back((float)cx, (float)cy);\n\n        // \u6784\u5efa OBB\n        triOBB = OBB2D(pts);\n\n        // \u4e3a\u4e86\u9632\u6b62\u6d6e\u70b9\u8bef\u5dee\u5bfc\u81f4\u8fb9\u7f18\u50cf\u7d20\u4e22\u5931\uff0c\u7a0d\u5fae\u6269\u5927\u4e00\u70b9 OBB\n        // \u8fd9\u662f\u4e00\u4e2a\u5de5\u7a0b\u6280\u5de7\uff0c\u7ed9\u534a\u957f\u589e\u52a0 0.5 - 1.0 \u7684\u5bb9\u5dee\n        triOBB.halfExtents[0] += 0.5f;\n        triOBB.halfExtents[1] += 0.5f;\n\n        use_obb_culling = true;\n    }\n#pragma omp parallel for\n    for(int x = bboxmax_x; x &gt;= bboxmin_x; x--) {\n        for(int y = bboxmax_y; y &gt;= bboxmin_y; y--) {\n\n            if (use_obb_culling) {\n                // \u4f7f\u7528\u50cf\u7d20\u4e2d\u5fc3\u70b9 (x + 0.5, y + 0.5) \u8fdb\u884c\u6d4b\u8bd5\u7cbe\u5ea6\u66f4\u9ad8\n                Vec2f pixelCenter((float)x + 0.5f, (float)y + 0.5f);\n\n                if (!triOBB.containsPoint(pixelCenter)) {\n                    continue;\n                }\n            }\n\n            double alpha = signed_triangle_area(x, y, bx, by, cx, cy) / total_area;\n            if (alpha &lt; 0)continue;\n\n            double beta = signed_triangle_area(ax, ay, x, y, cx, cy) / total_area;\n            if (beta &lt; 0)continue;\n\n            double gamma = signed_triangle_area(ax, ay, bx, by, x, y) / total_area;\n            if (gamma &lt; 0)continue;\n\n            framebuffer.set(x, y, color);\n\n        }\n    }\n}\n</code></pre> <p>\u6700\u540e\u7684\u7ed3\u679c\u662f33\u79d2\uff0c\u867d\u7136\u4e0d\u5c3d\u4eba\u610f\uff0c\u4f46\u662f\u4e5f\u7b97\u987a\u4fbf\u590d\u4e60\u4e86\u7ebf\u4ee3 ^ ^</p>"},{"location":"TinyRenderer/#_9","title":"\u5224\u65ad\u70b9\u5728\u4e09\u89d2\u5f62\u5185\u5916","text":""},{"location":"TinyRenderer/#_10","title":"\u91cd\u5fc3\u5750\u6807\u6cd5","text":"<p>\u5bf9\u4e8e\u4e09\u89d2\u5f62ABC</p> <p>\u4efb\u610f\u70b9\u53ef\u8868\u793a\u4e3a\uff1a</p> <p>$$P=uA+vB+wC,u+v+w=1$$</p> <p>\u5185\u5916\u5224\u5b9a\uff1a</p> <p>$$u\u22650, v\u22650, w\u22650$$</p> <p>$$u\u3001v\u3001w $$\u53ef\u7531\u6709\u5411\u9762\u79ef\u6bd4\u6c42\u5f97\uff08\u4e0e\u8fb9\u51fd\u6570\u7b49\u4ef7\uff09\uff1a</p> <p>$$u =\\tfrac{S_{PBC}} {S_{ABC}}$$\uff0c$$u =\\tfrac{S_{PAC}} {S_{ABC}}$$\uff0c$$u =\\tfrac{S_{ABP}} {S_{ABC}}$$</p> <p>\u4f18\u52bf</p> <ol> <li>\u4e0d\u53ea\u5224\u5185\u5916\uff0c\u66f4\u7528\u4e8e\u63d2\u503c\uff1a\u7eb9\u7406\u5750\u6807\u3001\u9876\u70b9\u8272\u3001\u6cd5\u7ebf\u3001\u96fe\u7cfb\u6570\u7b49\u7b49</li> <li>\u51e0\u4f55\u610f\u4e49\u6e05\u6670\uff0c\u6570\u5b66\u4e25\u8c28</li> <li>\u4e0e\u8fb9\u51fd\u6570\u6cd5\u6570\u5b66\u7b49\u4ef7\uff0c\u53ea\u662f\u8868\u73b0\u5f62\u5f0f\u4e0d\u540c</li> </ol> <p>\u7f3a\u70b9</p> <p>\u9700\u8981\u9664\u6cd5\uff08\u6d6e\u70b9\uff09\uff0c\u7eaf\u4e3a\u4e86\u5224\u70b9\u5185\u5916\u53cd\u800c\u66f4\u91cd\uff0c\u4e0d\u5982\u8fb9\u51fd\u6570\u9ad8\u6548\u3002</p> <p>aabb+\u91cd\u5fc3\u5750\u6807\uff1a</p> <p></p>"},{"location":"TinyRenderer/#_11","title":"\u8fb9\u51fd\u6570\u6cd5","text":"<p>\u5bf9\u4e8e\u4e09\u89d2\u5f62ABC\uff0c\u5b9a\u4e49\u4e09\u6761\u6709\u5411\u8fb9\u51fd\u6570\uff1a $$ e_1(P)=(B_x-A_x)(P_y-A_y)-(B_y-A_y)(P_x-A_x)\uff0c\u5373 AB\\times AP\\ e_2(P)=(C_x-B_x)(P_y-B_y)-(C_y-B_y)(P_x-B_x)\uff0c\u5373BC\\times BP\\ e_3(P)=(A_x-C_x)(P_y-C_y)-(A_y-C_y)(P_x-C_x)\uff0c\u5373CA\\times CP\\ \\ $$ \u5224\u65ad\u89c4\u5219</p> <p>\u4e09\u89d2\u5f62\u4e3a \u9006\u65f6\u9488\u73af\u7ed5\uff1a$$e_1\u22650, e_2\u22650, e_3\u22650$$</p> <p>\u987a\u65f6\u9488\u5219\u5168\u90e8 \u2264 0</p> <p>\uff08\u5b9e\u9645\u786c\u4ef6\u4f1a\u7edf\u4e00\u73af\u7ed5\u65b9\u5411\uff09</p> <p>\u4f18\u52bf</p> <ol> <li>\u65e0\u9664\u6cd5\u3001\u65e0\u5f00\u65b9\uff1a\u7eaf\u52a0\u51cf\u4e58\uff0c\u53ef\u5b9a\u70b9 / \u6574\u6570\u8fd0\u7b97</li> <li>\u5e76\u884c\u53cb\u597d\u3001\u9010\u50cf\u7d20\u72ec\u7acb\u8ba1\u7b97\uff1a\u5b8c\u7f8e\u9002\u914d GPU \u6d41\u5904\u7406\u5668</li> <li>\u53ef\u76f4\u63a5\u63a8\u5bfc\u91cd\u5fc3\u5750\u6807\uff1a\u987a\u4fbf\u5f97\u5230\u7eb9\u7406 / \u989c\u8272 / \u6cd5\u7ebf\u63d2\u503c\u6743\u91cd</li> <li>\u5929\u7136\u652f\u6301 subpixel \u91c7\u6837\u3001\u53cd\u8d70\u6837</li> <li>\u6613\u5b9e\u73b0 top-left rule\uff08\u907f\u514d\u8fb9\u91cd\u590d\u7ed8\u5236 / \u6f0f\u753b\uff09</li> </ol> <p>\u7f3a\u70b9</p> <p>\u4f9d\u8d56\u9876\u70b9\u73af\u7ed5\u987a\u5e8f\uff0c\u8fb9\u754c\u9700\u989d\u5916\u89c4\u5219\u5904\u7406\u3002</p> <p>\u8fb9\u51fd\u6570\u6cd5\u548c\u91cd\u5fc3\u5750\u6807\u5728\u6570\u5b66\u4e0a\u5b8c\u5168\u7b49\u4ef7\uff0c\u8fb9\u51fd\u6570\u7684\u6570\u503c = \u5bf9\u5e94\u5b50\u4e09\u89d2\u5f62\u7684 2 x \u6709\u5411\u9762\u79ef\uff08\u6bd5\u7adf\u662f\u53c9\u4e58\u561b\uff09\uff0c\u91cd\u5fc3\u5750\u6807\u7684\u672c\u8d28\u662f\u5b50\u4e09\u89d2\u5f62\u9762\u79ef/\u539f\u4e09\u89d2\u5f62\u603b\u9762\u79ef\uff0c\u4e24\u8005\u7684\u8f6c\u6362\u53ea\u9700\u8981\u901a\u8fc7\u9762\u79ef\u6bd4\u6765\u5b9e\u73b0\u3002</p> <p>\u7531\u4e8e\u6211\u4eec\u76ee\u524d\u7684\u8f6f\u5149\u6805\u53ea\u9700\u8981\u5224\u5185\u5916\uff0c\u6240\u4ee5\u53ef\u4ee5\u4e0d\u8981\u6602\u8d35\u7684\u6d6e\u70b9\u9664\u6cd5\uff0c\u6539\u7528\u8fb9\u51fd\u6570\u6cd5\u6765\u5224\u65ad\u3002</p> <p>\u4f46\u662f\u5982\u679c\u76f4\u63a5\u5bf9\u6bcf\u4e2a\u50cf\u7d20\u90fd\u5b8c\u6574\u7b97\u53c9\u4e58\uff0c\u4f1a\u4ea7\u751f\u5927\u91cf\u4e58\u6cd5\u3001\u52a0\u6cd5\uff0c\u8fd9\u53cd\u800c\u4f1a\u53d8\u5f97\u66f4\u6162\uff0c\u56e0\u6b64\u6211\u53c2\u8003\u4e86\u73b0\u4ee3GPU\u5149\u6805\u5316\u5668\u4f7f\u7528\u7684\u589e\u91cf\u8ba1\u7b97\u7684\u65b9\u6cd5\u3002\u8fd9\u79cd\u65b9\u6cd5\u901a\u5e38\u88ab\u79f0\u4e3a Pineda \u7b97\u6cd5 (Edge Function Method) \u7684\u589e\u91cf\u5b9e\u73b0\u3002</p>"},{"location":"TinyRenderer/#_12","title":"\u6570\u5b66\u539f\u7406","text":"<p>\u4e09\u89d2\u5f62\u7684\u4e09\u6761\u8fb9\u5176\u5b9e\u5c31\u662f\u4e09\u6761\u76f4\u7ebf\u3002\u5bf9\u4e8e\u76f4\u7ebf $Ax + By + C = 0$\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u8fb9\u51fd\u6570 $E(x, y) = Ax + By + C$\u3002</p> <ul> <li>\u5982\u679c $E(x, y) &gt; 0$\uff0c\u70b9\u5728\u76f4\u7ebf\u67d0\u4e00\u4fa7\u3002</li> <li>\u5982\u679c $E(x, y) &lt; 0$\uff0c\u70b9\u5728\u53e6\u4e00\u4fa7\u3002</li> <li>\u5982\u679c $E(x, y) = 0$\uff0c\u70b9\u5728\u76f4\u7ebf\u4e0a\u3002</li> </ul> <p>\u5982\u679c\u4e00\u4e2a\u70b9 $(x, y)$ \u540c\u65f6\u6ee1\u8db3\u4e09\u6761\u8fb9\u7684 $E &gt; 0$\uff08\u53d6\u51b3\u4e8e\u7ed5\u5e8f\uff09\uff0c\u90a3\u4e48\u8fd9\u4e2a\u70b9\u5c31\u5728\u4e09\u89d2\u5f62\u5185\u90e8\u3002</p>"},{"location":"TinyRenderer/#_13","title":"\u5173\u4e8e\u201c\u589e\u91cf\u201d","text":"<p>\u57fa\u4e8e\u7ebf\u6027\u51fd\u6570\u7684\u6027\u8d28\u3002 \u5047\u8bbe\u6211\u4eec\u5728 $(x, y)$ \u5904\u8ba1\u7b97\u51fa\u4e86 $E(x, y)$\u3002\u5f53\u6211\u4eec\u5411\u53f3\u79fb\u52a8\u4e00\u4e2a\u50cf\u7d20\u5230 $(x+1, y)$ \u65f6\uff1a $$ \\begin{aligned} E(x+1, y) &amp;= A(x+1) + By + C \\ &amp;= (Ax + By + C) + A \\ &amp;= E(x, y) + A \\end{aligned} $$</p> <p>\u8fd9\u610f\u5473\u7740\uff1a \u53ea\u8981\u4f60\u77e5\u9053\u4e86\u8d77\u70b9\u7684 $E$ \u503c\uff0c\u8ba1\u7b97\u4e0b\u4e00\u4e2a\u50cf\u7d20\u7684 $E$ \u503c\u53ea\u9700\u8981\u505a\u4e00\u6b21\u52a0\u6cd5\uff08\u52a0\u4e0a\u7cfb\u6570 $A$\uff09\u3002\u540c\u7406\uff0c\u6362\u884c\u65f6\uff08$y+1$\uff09\uff0c\u53ea\u9700\u8981\u52a0\u4e0a\u7cfb\u6570 $B$\u3002</p> <p>\u90a3\u4e48\u6211\u4eec\u6765\u770b\u4ee3\u7801\u5b9e\u73b0\uff1a\uff08\u4ee5\u4e0b\u4fee\u6539\u90fd\u5728main.cpp\u4e2d\uff09</p> <pre><code>struct EdgeFunc {\n    int a, b, c;       // E = a*x + b*y + c\n    int step_x;        // x+1\u65f6\uff0cE += step_x (\u5373a)\n    int step_y;        // y+1\u65f6\uff0cE += step_y (\u5373b)\n};\n\nvoid precompute_edge_funcs(Vec2i A, Vec2i B, Vec2i C,\n    EdgeFunc&amp; e1, EdgeFunc&amp; e2, EdgeFunc&amp; e3) {\n\n    // \u8fb91: A-&gt;B\n    e1.a = A.y - B.y;\n    e1.b = B.x - A.x;\n    e1.c = B.y * A.x - B.x * A.y; // \u8fd9\u79cd\u5f62\u5f0f\u7b49\u4ef7\u4e8e\u539f\u6765\u7684\u53c9\u4e58\u5f62\u5f0f\n    e1.step_x = e1.a;\n    e1.step_y = e1.b;\n\n    // \u8fb92: B-&gt;C\n    e2.a = B.y - C.y;\n    e2.b = C.x - B.x;\n    e2.c = C.y * B.x - C.x * B.y;\n    e2.step_x = e2.a;\n    e2.step_y = e2.b;\n\n    // \u8fb93: C-&gt;A\n    e3.a = C.y - A.y;\n    e3.b = A.x - C.x;\n    e3.c = A.y * C.x - A.x * C.y;\n    e3.step_x = e3.a;\n    e3.step_y = e3.b;\n}\n\ndouble signed_triangle_area(int ax, int ay, int bx, int by, int cx, int cy) {\n    return .5 * ((by - ay) * (bx + ax) + (cy - by) * (cx + bx) + (ay - cy) * (ax + cx));\n}\n\nvoid triangle(int ax, int ay, int bx, int by, int cx, int cy, TGAImage&amp; framebuffer, TGAColor color) {\n    double total_area = signed_triangle_area(ax, ay, bx, by, cx, cy);\n    if (total_area &lt; 1)return;\n\n    Vec2i A(ax, ay);\n    Vec2i B(bx, by);\n    Vec2i C(cx, cy);\n    EdgeFunc e1, e2, e3;\n    precompute_edge_funcs(A, B, C, e1, e2, e3);\n\n    int min_x = std::min({ ax, bx, cx });\n    int max_x = std::max({ ax, bx, cx });\n    int min_y = std::min({ ay, by, cy });\n    int max_y = std::max({ ay, by, cy });\n\n\n    // \u5c4f\u5e55\u88c1\u526a \n    min_x = std::max(0, min_x);\n    max_x = std::min(framebuffer.width() - 1, max_x);\n    min_y = std::max(0, min_y);\n    max_y = std::min(framebuffer.height() - 1, max_y);\n\n    if (max_x &lt; min_x || max_y &lt; min_y) return;\n\n\n#pragma omp parallel for\n    for(int y = min_y; y &lt;= max_y; y++) {\n\n        // \u8ba1\u7b97\u5f53\u524d\u884c\u5f00\u59cb\u5904 (min_x, y) \u7684\u8fb9\u51fd\u6570\u503c\n        // E(x, y) = a*x + b*y + c\n        int row_E1 = e1.a * min_x + e1.b * y + e1.c;\n        int row_E2 = e2.a * min_x + e2.b * y + e2.c;\n        int row_E3 = e3.a * min_x + e3.b * y + e3.c;\n\n        for(int x = min_x; x &lt;= max_x; x++) {\n            if ((row_E1 | row_E2 | row_E3) &gt;= 0) {\n                framebuffer.set(x, y, color);\n            }\n\n            // x \u524d\u8fdb 1 \u6b65\uff0c\u8fb9\u51fd\u6570\u503c\u589e\u52a0 step_x (\u5373 a)\n            row_E1 += e1.step_x;\n            row_E2 += e2.step_x;\n            row_E3 += e3.step_x;\n\n        }\n    }\n}\n</code></pre> <p>\u6700\u540e\u7ed3\u679c\uff1a</p> <p></p> <p></p> <p>\u54e6\u8036~\u76f4\u63a5\u5feb\u4e86\u4e00\u534a\u3002^ ^</p>"},{"location":"TinyRenderer/#_14","title":"\u601d\u8003","text":"<p>\u5176\u5b9e\u4e0a\u9762\u63d0\u5230\uff0c\u8fb9\u51fd\u6570\u6cd5\u548c\u91cd\u5fc3\u5750\u6807\u5728\u6570\u5b66\u4e0a\u662f\u7b49\u4ef7\u7684\uff0c\u8fb9\u51fd\u6570\u662f\u7ebf\u6027\u53d8\u5316\u7684\uff0c\u91cd\u5fc3\u5750\u6807\u5c31\u662f\u591a\u9664\u4ee5\u4e86\u4e2a\u603b\u9762\u79ef\uff0c\u6240\u4ee5\u91cd\u5fc3\u5750\u6807\u5b9e\u9645\u4e0a\u5e94\u8be5\u4e5f\u662f\u7ebf\u6027\u53d8\u5316\u7684\u3002\u5b8c\u5168\u53ef\u4ee5\u5bf9\u91cd\u5fc3\u5750\u6807\u4f7f\u7528\u589e\u91cf\u6cd5\u3002\u56e0\u6b64\u4e00\u4e0b\u5b50\u5feb\u4e86\u8fd9\u4e48\u591a\u5176\u5b9e\u4e0d\u4e00\u5b9a\u662f\u628a\u9664\u6cd5\u4f18\u5316\u6389\u5e26\u6765\u7684\uff0c\u66f4\u53ef\u80fd\u662f\u589e\u91cf\u6cd5\u7684\u6548\u679c\u3002</p> <p>\u4e0d\u8fc7\u5f88\u663e\u7136\u6211\u66f4\u559c\u6b22\u8fb9\u51fd\u6570\u6cd5\uff0c\u5148\u901a\u8fc7\u6d4b\u8bd5\uff0c\u518d\u8c08\u63d2\u503c\u989c\u8272\u3001\u6df1\u5ea6\u3001UV\u2026\u2026</p> <p>\u800c\u4e14\u7406\u8bba\u4e0a\u6765\u8bf4\u53ef\u4ee5\u66f4\u5feb\uff0c\u628a\u76ee\u524d\u6211\u7684\u8fd9\u4e2a\u5faa\u73af\u662f\u7f13\u5b58\u53cb\u597d\u7684\uff0c\u5982\u679c\u60f3\u8fdb\u4e00\u6b65\u538b\u69a8\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u628a<code>triangle</code>\u51fd\u6570\u91cc\u7684\u8ba1\u7b97\u903b\u8f91\u6539\u6210SIMD\u7248\u672c\u3002\u73b0\u5728\u60f3\u5230\u52a0\u8f7d\u6a21\u578b\u7684\u65f6\u5019\u5176\u5b9e\u5c31\u53ef\u4ee5\u8fd9\u4e48\u6539\u4e86\uff1a</p> <pre><code>//\u539f\u6709\u7684\u5b58\u50a8\u6a21\u578b\u9876\u70b9\u7684\u5927\u6982\u903b\u8f91\nstruct Vec3f { float x, y, z; };\nvector&lt;Vec3f&gt; vertices; \n</code></pre> <p>\u53ef\u4ee5\u6539\u6210\uff1a</p> <pre><code>struct Vertices {\n    vector&lt;float&gt; xs;\n    vector&lt;float&gt; ys;\n    vector&lt;float&gt; zs;\n};\n</code></pre> <p>\u540c\u7406\u53ef\u4ee5\u628a<code>triangle</code>\u51fd\u6570\u91cc\u9762\u7684\u8ba1\u7b97\u903b\u8f91\u6539\u6210\u7c7b\u4f3c\u7684\u8bd5\u8bd5\u770b\uff0c\u62ff\u5185\u5b58\u6362\u901f\u5ea6\u8fd9\u4e00\u5757\uff0c\u4e0d\u8fc7\u73b0\u5728\u7ed8\u5236\u4e00\u5e27\u5927\u6982\u53ea\u9700\u89810.006\u79d2\uff0c\u5c31\u5148\u4e0d\u4f18\u5316\u4e86\u55b5\u3002</p>"}]}